

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Middleware &mdash; django-email-auth v1.0a1 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0a1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="django-email-auth v1.0a1 documentation" href="index.html" />
    <link rel="next" title="GNU General Public License" href="gpl3.html" />
    <link rel="prev" title="Forms" href="forms.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="gpl3.html" title="GNU General Public License"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="forms.html" title="Forms"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">django-email-auth v1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="middleware">
<h1>Middleware<a class="headerlink" href="#middleware" title="Permalink to this headline">¶</a></h1>
<p>In Django, middleware is called for each request and response. It can be used
to modify the input and/or output independently of the views. We use it to
modify some of the built-in behaviour of the Django administration interface
(<tt class="docutils literal"><span class="pre">django.contrib.admin</span></tt>) to better integrate it with the custom backend.</p>
<p>See the <a class="reference external" href="http://docs.djangoproject.com/en/dev/topics/http/middleware/">Django middleware documentation</a>
for more information on middleware.</p>
<div class="section" id="emailauthmiddleware">
<h2>EmailAuthMiddleware<a class="headerlink" href="#emailauthmiddleware" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="email_auth.middleware.EmailAuthMiddleware">
<em class="property">class </em><tt class="descclassname">email_auth.middleware.</tt><tt class="descname">EmailAuthMiddleware</tt><a class="headerlink" href="#email_auth.middleware.EmailAuthMiddleware" title="Permalink to this definition">¶</a></dt>
<dd><p>Many of the views in the Django administration interface use the
<tt class="docutils literal"><span class="pre">&#64;staff_member_required</span></tt> decorator to ensure that the user has staff
permissions. However, the built-in decorator provides its own login form
rather than using the <tt class="docutils literal"><span class="pre">LOGIN_URL</span></tt> specified in the settings. This has
hard-coded field names (so the user is prompted for a username rather than a
password). It also gives misleading error messages; for example, if the user
enters their password wrong they are told that their username cannot contain
the &#8216;&#64;&#8217; character. Finally, if they successfully log in but don&#8217;t have staff
status, they are prompted to log in again rather than being told what the
problem is.</p>
<p>This piece of middleware overcomes this by replacing the decorator with a
custom version. It redirects the user to the settings <tt class="docutils literal"><span class="pre">LOGIN_URL</span></tt> when
needed, allowing any customisations made to the login view (such as custom
authentication forms) to be used. If the user is logged in but does not have
staff status, it uses the <tt class="docutils literal"><span class="pre">admin/not_staff.html</span></tt> template to tell them
this. As a sanity check, it checks that they have an active account (this
should have been done by the login view) and, if not, tells them so using
the <tt class="docutils literal"><span class="pre">admin/inactive.html</span></tt> template.</p>
<p>For this to work correctly, you must:</p>
<ul class="simple">
<li>Configure <tt class="docutils literal"><span class="pre">LOGIN_URL</span></tt> in your settings to point to your login view.</li>
<li>Ensure your login view correctly handles the <tt class="docutils literal"><span class="pre">next</span></tt> parameter to
redirect the user to the appropriate page after login.</li>
<li>Make the <tt class="docutils literal"><span class="pre">admin/inactive.html</span></tt> and <tt class="docutils literal"><span class="pre">admin/not_staff.html</span></tt> templates
available to the Django template loader. Templates are provided in the
<tt class="docutils literal"><span class="pre">email_auth/templates</span></tt> directory of the project, or you can create your
own using these as a guide.</li>
</ul>
<p>It is recommended that you place this as the first piece of middleware to be
used. If another piece of middleware above this directly generates a
response, it may use the default decorator.</p>
<dl class="function">
<dt id="email_auth.middleware.EmailAuthMiddleware.process_request">
<tt class="descname">process_request</tt><big>(</big><em>request</em><big>)</big><a class="headerlink" href="#email_auth.middleware.EmailAuthMiddleware.process_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Django calls this function for every request made. It replaces the
<tt class="docutils literal"><span class="pre">django.contrib.admin.views.decorators.staff_member_required</span></tt> decorator
with the custom version.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Middleware</a><ul>
<li><a class="reference internal" href="#emailauthmiddleware">EmailAuthMiddleware</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="forms.html"
                        title="previous chapter">Forms</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="gpl3.html"
                        title="next chapter">GNU General Public License</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/middleware.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="gpl3.html" title="GNU General Public License"
             >next</a></li>
        <li class="right" >
          <a href="forms.html" title="Forms"
             >previous</a> |</li>
        <li><a href="index.html">django-email-auth v1.0a1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Blair Bonnett.
      Last updated on Sep 22, 2010.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.3.
    </div>
  </body>
</html>